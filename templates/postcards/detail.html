{% extends "base.html" %}

{% block title %}{{ postcard.title }} | Postcard Database{% endblock %}

{% block content %}
<section class="postcard-detail">
    <div class="postcard-header">
        <h1>{{ postcard.title }}</h1>
        <div class="postcard-actions">
            <a href="{{ url_for('edit_postcard', postcard_id=postcard.id) }}" class="btn secondary">Edit</a>
            <button type="button" class="btn danger" id="delete-btn">Delete</button>
        </div>
    </div>
    
    <div class="postcard-images">
        <div class="image-container front">
            <h3>Front</h3>
            {% if postcard.front_image_url %}
                <img src="{{ postcard.front_image_url }}" alt="Front of {{ postcard.title }}" class="postcard-image" 
                     onError="this.onerror=null;this.src='';this.alt='Image failed to load';this.classList.add('image-error');">
                <div class="image-debug">
                    <div>URL: {{ postcard.front_image_url }}</div>
                    <div>UUID: {{ postcard.front_image_url.split('/')[-1].split('.')[0] }}</div>
                    <div>UUID Length: {{ postcard.front_image_url.split('/')[-1].split('.')[0]|length }}</div>
                </div>
            {% else %}
                <div class="postcard-placeholder large">No Front Image</div>
            {% endif %}
        </div>
        
        <div class="image-container back">
            <h3>Back</h3>
            {% if postcard.back_image_url %}
                <img src="{{ postcard.back_image_url }}" alt="Back of {{ postcard.title }}" class="postcard-image"
                     onError="this.onerror=null;this.src='';this.alt='Image failed to load';this.classList.add('image-error');">
                <div class="image-debug">
                    <div>URL: {{ postcard.back_image_url }}</div>
                    <div>UUID: {{ postcard.back_image_url.split('/')[-1].split('.')[0] }}</div>
                    <div>UUID Length: {{ postcard.back_image_url.split('/')[-1].split('.')[0]|length }}</div>
                </div>
            {% else %}
                <div class="postcard-placeholder large">No Back Image</div>
            {% endif %}
        </div>
    </div>
    
    <div class="postcard-metadata">
        <div class="metadata-group">
            <h3>Details</h3>
            <table>
                <tr>
                    <th>Era:</th>
                    <td>{{ postcard.era or 'Unknown' }}</td>
                </tr>
                <tr>
                    <th>Type:</th>
                    <td>{{ postcard.type or 'Unknown' }}</td>
                </tr>
                <tr>
                    <th>Manufacturer:</th>
                    <td>{{ postcard.manufacturer or 'Unknown' }}</td>
                </tr>
                <tr>
                    <th>Posted:</th>
                    <td>{% if postcard.is_posted %}Yes{% else %}No{% endif %}</td>
                </tr>
                <tr>
                    <th>Written:</th>
                    <td>{% if postcard.is_written %}Yes{% else %}No{% endif %}</td>
                </tr>
                <tr>
                    <th>Added:</th>
                    <td>{{ postcard.created_at|datetime }}</td>
                </tr>
            </table>
        </div>
        
        <div class="metadata-group">
            <h3>Description</h3>
            <div class="description">
                {% if postcard.description %}
                    {{ postcard.description|nl2br }}
                {% else %}
                    <p class="no-content">No description provided.</p>
                {% endif %}
            </div>
        </div>
        
        <div class="metadata-group">
            <h3>Tags</h3>
            <div class="tags">
                {% if tags %}
                    {% for tag in tags %}
                        <span class="tag">{{ tag.name }}</span>
                    {% endfor %}
                {% else %}
                    <p class="no-content">No tags assigned.</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Delete confirmation modal -->
    <div class="modal" id="delete-modal">
        <div class="modal-content">
            <h3>Confirm Deletion</h3>
            <p>Are you sure you want to delete this postcard? This action cannot be undone.</p>
            <div class="modal-actions">
                <form action="{{ url_for('delete_postcard', postcard_id=postcard.id) }}" method="post">
                    <button type="submit" class="btn danger">Delete</button>
                </form>
                <button type="button" class="btn secondary" id="cancel-delete">Cancel</button>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const deleteBtn = document.getElementById('delete-btn');
        const cancelBtn = document.getElementById('cancel-delete');
        const modal = document.getElementById('delete-modal');
        
        deleteBtn.addEventListener('click', function() {
            modal.classList.add('visible');
        });
        
        cancelBtn.addEventListener('click', function() {
            modal.classList.remove('visible');
        });
        
        // Enhanced styles for debug info and error handling
        const style = document.createElement('style');
        style.textContent = `
            .image-debug {
                font-size: 10px;
                color: #666;
                margin-top: 5px;
                word-break: break-all;
                background: #f7f7f7;
                padding: 5px;
                border-radius: 3px;
            }
            .image-error {
                border: 2px solid #ff0000;
                padding: 10px;
                color: #ff0000;
                background: #fff0f0;
                text-align: center;
                min-height: 100px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
        `;
        document.head.appendChild(style);
    });
</script>
{% endblock %}